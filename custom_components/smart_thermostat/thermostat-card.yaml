type: vertical-stack
cards:
  - type: custom:mushroom-template-card
    primary: Smart Thermostat Status
    secondary: >
      {{ states('climate.thermostat') }}
    icon: mdi:thermostat
    fill_container: true
    entity: climate.thermostat
    tap_action:
      action: toggle
    hold_action:
      action: more-info
    
  - type: grid
    columns: 2
    square: false
    cards:
      - type: custom:mushroom-template-card
        primary: Bedroom
        secondary: >
          {{ states('sensor.bedroom_temperature') }}°C
        icon: mdi:thermometer
        
      - type: custom:mushroom-template-card
        primary: Main Floor
        secondary: >
          {{ states('sensor.main_floor_temperature') }}°C
        icon: mdi:thermometer
        
      - type: custom:mushroom-template-card
        primary: Thermostat
        secondary: >
          {{ states('sensor.thermostat_current_temperature') }}°C
        icon: mdi:thermometer
        
      - type: custom:mushroom-template-card
        primary: Average
        secondary: >
          {% set temps = [] %}
          {% for sensor in [
            states('sensor.bedroom_temperature'),
            states('sensor.main_floor_temperature'),
            states('sensor.thermostat_current_temperature')
          ] %}
            {% if sensor != 'unknown' and sensor != 'unavailable' %}
              {% set temps = temps + [sensor|float] %}
            {% endif %}
          {% endfor %}
          {% if temps|length > 0 %}
            {{ (temps|sum / temps|length)|round(1) }}°C
          {% else %}
            unknown°C
          {% endif %}
        icon: mdi:thermometer-lines

  - type: custom:mushroom-climate-card
    entity: climate.thermostat
    fill_container: true
    show_temperature_control: true
    hvac_modes:
      - "off"
      - "heat"
    
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-template-card
        primary: Occupancy
        secondary: >
          {% if is_state('binary_sensor.main_floor_occupancy', 'on') 
             or is_state('binary_sensor.thermostat_occupancy', 'on')
             or is_state('binary_sensor.bedroom_occupancy', 'on') %}
            Occupied
          {% else %}
            Unoccupied
          {% endif %}
        icon: >
          {% if is_state('binary_sensor.main_floor_occupancy', 'on') 
             or is_state('binary_sensor.thermostat_occupancy', 'on')
             or is_state('binary_sensor.bedroom_occupancy', 'on') %}
            mdi:home-account
          {% else %}
            mdi:home-outline
          {% endif %}
          
      - type: custom:mushroom-template-card
        primary: HVAC Status
        secondary: >
          {% if states('climate.thermostat') == 'off' %}
            Off
          {% elif states('climate.thermostat') == 'heat' %}
            {% if state_attr('climate.thermostat', 'hvac_action') == 'heating' %}
              Heating
            {% else %}
              Idle
            {% endif %}
          {% else %}
            {{ states('climate.thermostat') }}
          {% endif %}
        icon: >
          {% if states('climate.thermostat') == 'heat' and state_attr('climate.thermostat', 'hvac_action') == 'heating' %}
            mdi:fire
          {% elif states('climate.thermostat') == 'heat' %}
            mdi:thermostat
          {% else %}
            mdi:hvac-off
          {% endif %} 

  - type: custom:mushroom-template-card
    primary: Recent Actions
    secondary: >
      {% set history = state_attr('climate.thermostat', 'action_history') %}
      {% if history %}
        {% for action in history %}
          {{ action }}{% if not loop.last %}<br>{% endif %}
        {% endfor %}
      {% else %}
        No actions recorded
      {% endif %}
    icon: mdi:history
    layout: vertical
    multiline_secondary: true
    fill_container: true 