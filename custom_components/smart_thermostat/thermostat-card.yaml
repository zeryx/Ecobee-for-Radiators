type: vertical-stack
cards:
  - type: custom:mushroom-template-card
    primary: Smart Thermostat Status
    secondary: >
      {{ states('climate.smart_thermostat') }}
    icon: mdi:thermostat
    fill_container: true
    entity: climate.smart_thermostat
    tap_action:
      action: toggle
    hold_action:
      action: more-info
    
  - type: grid
    columns: 2
    square: false
    cards:
      - type: custom:mushroom-template-card
        primary: Bedroom
        secondary: >
          {% set temps = state_attr('climate.smart_thermostat', 'sensor_temperatures') %}
          {% if temps and 'sensor.bedroom_temperature' in temps %}
            {{ temps['sensor.bedroom_temperature'] }}°C
          {% else %}
            No data
          {% endif %}
        icon: mdi:thermometer
        
      - type: custom:mushroom-template-card
        primary: Office
        secondary: >
          {% set temps = state_attr('climate.smart_thermostat', 'sensor_temperatures') %}
          {% if temps and 'sensor.office_temperature' in temps %}
            {{ temps['sensor.office_temperature'] }}°C
          {% else %}
            No data
          {% endif %}
        icon: mdi:thermometer
        
      - type: custom:mushroom-template-card
        primary: Thermostat
        secondary: >
          {% set temps = state_attr('climate.smart_thermostat', 'sensor_temperatures') %}
          {% if temps and 'sensor.thermostat_current_temperature' in temps %}
            {{ temps['sensor.thermostat_current_temperature'] }}°C
          {% else %}
            No data
          {% endif %}
        icon: mdi:thermometer
        
      - type: custom:mushroom-template-card
        primary: HVAC Controller
        secondary: >
          {% set temps = state_attr('climate.smart_thermostat', 'sensor_temperatures') %}
          {% if temps and 'sensor.hvac_controller_temperature' in temps %}
            {{ temps['sensor.hvac_controller_temperature'] }}°C
          {% else %}
            No data
          {% endif %}
        icon: mdi:thermometer

      - type: custom:mushroom-template-card
        primary: Average
        secondary: >
          {% set temps = state_attr('climate.smart_thermostat', 'sensor_temperatures') %}
          {% if temps %}
            {% set avg = state_attr('climate.smart_thermostat', 'average_temperature') %}
            {{ avg|round(1) }}°C
          {% else %}
            No data
          {% endif %}
        icon: mdi:thermometer-lines

  - type: custom:mushroom-climate-card
    entity: climate.smart_thermostat
    fill_container: true
    show_temperature_control: true
    hvac_modes:
      - "off"
      - "heat"
    
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-template-card
        primary: Occupancy
        secondary: >
          {% if is_state('binary_sensor.main_floor_occupancy', 'on') 
             or is_state('binary_sensor.thermostat_occupancy', 'on')
             or is_state('binary_sensor.bedroom_occupancy', 'on') %}
            Occupied
          {% else %}
            Unoccupied
          {% endif %}
        icon: >
          {% if is_state('binary_sensor.main_floor_occupancy', 'on') 
             or is_state('binary_sensor.thermostat_occupancy', 'on')
             or is_state('binary_sensor.bedroom_occupancy', 'on') %}
            mdi:home-account
          {% else %}
            mdi:home-outline
          {% endif %}
          
      - type: custom:mushroom-template-card
        primary: HVAC Status
        secondary: >
          {% if states('climate.smart_thermostat') == 'off' %}
            Off
          {% elif states('climate.smart_thermostat') == 'heat' %}
            {% if state_attr('climate.smart_thermostat', 'hvac_action') == 'heating' %}
              Heating
            {% else %}
              Idle
            {% endif %}
          {% else %}
            {{ states('climate.smart_thermostat') }}
          {% endif %}
        icon: >
          {% if states('climate.smart_thermostat') == 'heat' and state_attr('climate.smart_thermostat', 'hvac_action') == 'heating' %}
            mdi:fire
          {% elif states('climate.smart_thermostat') == 'heat' %}
            mdi:thermostat
          {% else %}
            mdi:hvac-off
          {% endif %}

  - type: custom:mushroom-template-card
    primary: Recent Actions
    secondary: >
      {% set history = state_attr('climate.smart_thermostat', 'action_history') %}
      {% if history %}
        {% for action in history %}
          {{ action }}{% if not loop.last %}<br>{% endif %}
        {% endfor %}
      {% else %}
        No actions recorded
      {% endif %}
    icon: mdi:history
    layout: vertical
    multiline_secondary: true
    fill_container: true 

  - type: horizontal-stack
    cards:
      - type: custom:mushroom-template-card
        primary: Cycle Status
        secondary: >
          {% set status = state_attr('climate.smart_thermostat', 'cycle_status') %}
          {% set type = state_attr('climate.smart_thermostat', 'cycle_type') %}
          {% set remaining = state_attr('climate.smart_thermostat', 'time_remaining') %}
          {% if type != 'idle' %}
            {{ type|title }} cycle: {{ remaining }}m remaining
          {% else %}
            Idle
          {% endif %}
        icon: >
          {% set type = state_attr('climate.smart_thermostat', 'cycle_type') %}
          {% if type == 'heating' %}
            mdi:fire-circle
          {% elif type == 'cooling' %}
            mdi:timer-sand
          {% else %}
            mdi:timer-off-outline
          {% endif %}
          
      - type: custom:mushroom-template-card
        primary: Learning Duration
        secondary: >
          {% set duration = state_attr('climate.smart_thermostat', 'learning_duration') %}
          {% if duration %}
            {{ duration }}m
          {% else %}
            Unknown
          {% endif %}
        icon: mdi:brain 